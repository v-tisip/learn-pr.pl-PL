## <a name="creating-key-vaults-for-your-applications"></a><span data-ttu-id="16c81-101">Tworzenie magazynów Key Vault na potrzeby aplikacji</span><span class="sxs-lookup"><span data-stu-id="16c81-101">Creating Key Vaults for your applications</span></span>

<span data-ttu-id="16c81-102">Dobrym rozwiązaniem jest przydzielenie poszczególnym aplikacjom osobnego magazynu dla każdego używanego środowiska wdrażania, takiego jak programowanie, testowanie i produkcja.</span><span class="sxs-lookup"><span data-stu-id="16c81-102">Good practice is to give each application a separate vault for each deployment environment you use, such as development, test, and production.</span></span> <span data-ttu-id="16c81-103">Wygodne może okazać się udostępnianie wpisów tajnych w aplikacji, ale wpływ dostępu do odczytu magazynu przez osobę atakującą zwiększa się wraz z liczbą wpisów tajnych w magazynie.</span><span class="sxs-lookup"><span data-stu-id="16c81-103">It may be convenient to share secrets across apps, but the impact of an attacker gaining read access to a vault increases with the number of secrets in the vault.</span></span>

> [!TIP]
> <span data-ttu-id="16c81-104">Jeśli używasz takich samych nazw wpisów tajnych w różnych środowiskach, jedyną konfiguracją specyficzną dla środowiska, którą trzeba zmienić w aplikacji, jest adres URL magazynu.</span><span class="sxs-lookup"><span data-stu-id="16c81-104">If you use the same names for secrets across different environments, the only environment-specific configuration that has to change in your app is the vault URL.</span></span>

<span data-ttu-id="16c81-105">Tworzenie magazynu nie wymaga konfiguracji początkowej.</span><span class="sxs-lookup"><span data-stu-id="16c81-105">Creating a vault requires no initial configuration.</span></span> <span data-ttu-id="16c81-106">Tożsamość użytkownika ma automatycznie przyznawany pełen zestaw uprawnień do zarządzania wpisami tajnymi i natychmiast można rozpocząć dodawanie wpisów tajnych.</span><span class="sxs-lookup"><span data-stu-id="16c81-106">Your user identity is automatically granted the full set of secret management permissions and you can start adding secrets immediately.</span></span> <span data-ttu-id="16c81-107">Po utworzeniu magazynu można dodawać wpisy tajne i zarządzać nimi przy użyciu dowolnego interfejsu administracyjnego platformy Azure, w tym witryny Azure Portal, interfejsu wiersza polecenia platformy Azure i programu Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="16c81-107">Once you have a vault, adding and managing secrets can be done from any Azure administrative interface, including the Azure portal, the Azure CLI, and Azure PowerShell.</span></span> <span data-ttu-id="16c81-108">W przypadku konfigurowania aplikacji do używania magazynu trzeba przypisać do niej prawidłowe uprawnienia; zobaczymy to w kolejnej sekcji.</span><span class="sxs-lookup"><span data-stu-id="16c81-108">When you set up your application to use the vault, you'll need to assign the correct permissions to it; we'll see that in the next unit.</span></span>

## <a name="vault-authentication-and-permissions"></a><span data-ttu-id="16c81-109">Uwierzytelnianie i uprawnienia użytkownika magazynu</span><span class="sxs-lookup"><span data-stu-id="16c81-109">Vault authentication and permissions</span></span>

<span data-ttu-id="16c81-110">Interfejs API usługi Azure Key Vault używa usługi Azure Active Directory do uwierzytelniania użytkowników i aplikacji.</span><span class="sxs-lookup"><span data-stu-id="16c81-110">Azure Key Vault's API uses Azure Active Directory to authenticate users and applications.</span></span> <span data-ttu-id="16c81-111">Zasady dostępu do magazynu opierają się na *akcjach* i są stosowane do całego magazynu.</span><span class="sxs-lookup"><span data-stu-id="16c81-111">Vault access policies are based on *actions*, and are applied across an entire vault.</span></span> <span data-ttu-id="16c81-112">Na przykład aplikacja z uprawnieniami do **pobierania** (odczytywania wartości wpisów tajnych), **tworzenia listy** (tworzenia listy wszystkich wpisów tajnych) i **ustawiania** (tworzenia lub aktualizowania wartości wpisów tajnych) do magazynu może tworzyć wpisy tajne, wyświetlać listę wszystkich nazw wpisów tajnych oraz pobierać i ustawiać wszystkie wartości wpisów tajnych w tym magazynie.</span><span class="sxs-lookup"><span data-stu-id="16c81-112">For example, an application with **Get** (read secret values), **List** (list names of all secrets), and **Set** (create or update secret values) permissions to a vault is able to create secrets, list all secret names, and get and set all secret values in that vault.</span></span>

<span data-ttu-id="16c81-113">*Wszystkie* akcje wykonywane w magazynie wymagają uwierzytelniania i autoryzacji &mdash; nie ma możliwości przyznania żadnych praw dostępu anonimowego.</span><span class="sxs-lookup"><span data-stu-id="16c81-113">*All* actions performed on a vault require authentication and authorization &mdash; there is no way to grant any kind of anonymous access.</span></span>

> [!TIP]
> <span data-ttu-id="16c81-114">W przypadku udzielania dostępu do magazynu deweloperom i aplikacjom należy przyznać tylko minimalny wymagany zestaw uprawnień.</span><span class="sxs-lookup"><span data-stu-id="16c81-114">When granting vault access to developers and apps, grant only the minimum set of permissions needed.</span></span> <span data-ttu-id="16c81-115">Ograniczenia uprawnień pomagają uniknąć awarii spowodowanych przez usterki kodu i zmniejszyć wpływ kradzieży poświadczeń lub wstrzyknięcia złośliwego kodu do aplikacji.</span><span class="sxs-lookup"><span data-stu-id="16c81-115">Permissions restrictions help avoid accidents caused by code bugs and reduce the impact of stolen credentials or malicious code injected into your app.</span></span>

<span data-ttu-id="16c81-116">Deweloperzy będą przeważnie potrzebować tylko uprawnień do **pobierania** i **tworzenia listy** w magazynie środowiska programistycznego.</span><span class="sxs-lookup"><span data-stu-id="16c81-116">Developers will usually only need **Get** and **List** permissions to a development-environment vault.</span></span> <span data-ttu-id="16c81-117">Lider lub starszy deweloper będzie potrzebować pełnych uprawnień do magazynu, aby w razie potrzeby zmieniać i dodawać wpisy tajne.</span><span class="sxs-lookup"><span data-stu-id="16c81-117">A lead or senior developer will need full permissions to the vault to change and add secrets when necessary.</span></span> <span data-ttu-id="16c81-118">Pełne uprawnienia do magazynów w środowisku produkcyjnym są zazwyczaj rezerwowane dla starszego personelu operacyjnego.</span><span class="sxs-lookup"><span data-stu-id="16c81-118">Full permissions to production-environment vaults are typically reserved for senior operations staff.</span></span>

<span data-ttu-id="16c81-119">W przypadku aplikacji są zazwyczaj wymagane tylko uprawnienia do **pobierania**.</span><span class="sxs-lookup"><span data-stu-id="16c81-119">For apps, typically only **Get** permissions are required.</span></span> <span data-ttu-id="16c81-120">Niektóre aplikacje mogą wymagać uprawnień do tworzenia **listy**, w zależności od sposobu implementowania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="16c81-120">Some apps may require **List** depending on the way the app is implemented.</span></span> <span data-ttu-id="16c81-121">Aplikacja, którą zaimplementujemy w ramach ćwiczenia w tym module wymaga uprawnienia do **tworzenia listy**, z powodu techniki używanej do odczytywania wpisów tajnych z magazynu.</span><span class="sxs-lookup"><span data-stu-id="16c81-121">The app we'll implement in this module's exercise requires the **List** permission because of the technique it uses to read secrets from the vault.</span></span>

## <a name="exercise"></a><span data-ttu-id="16c81-122">Ćwiczenie</span><span class="sxs-lookup"><span data-stu-id="16c81-122">Exercise</span></span>

<span data-ttu-id="16c81-123">Mając na uwadze wszystkie problemy z wpisami tajnymi aplikacji, kadra kierownicza poprosiła Cię o utworzenie małej aplikacji startowej, która wyznaczy właściwą ścieżkę działania dla innych deweloperów.</span><span class="sxs-lookup"><span data-stu-id="16c81-123">Given all the trouble the company's been having with application secrets, management has asked you to create a small starter app to set the other developers on the right path.</span></span> <span data-ttu-id="16c81-124">Aplikacja musi przedstawiać najlepsze rozwiązania dotyczące jak najprostszego i jak najbezpieczniejszego zarządzania wpisami tajnymi.</span><span class="sxs-lookup"><span data-stu-id="16c81-124">The app needs to demonstrate best practices for managing secrets as simply and securely as possible.</span></span>

<span data-ttu-id="16c81-125">Aby rozpocząć, utworzysz magazyn i będziesz przechowywać jeden wpis tajny.</span><span class="sxs-lookup"><span data-stu-id="16c81-125">To start, you'll create a vault and store one secret.</span></span>

### <a name="create-a-resource-group"></a><span data-ttu-id="16c81-126">Tworzenie grupy zasobów</span><span class="sxs-lookup"><span data-stu-id="16c81-126">Create a resource group</span></span>

<span data-ttu-id="16c81-127">Utwórz grupę zasobów o nazwie `keyvault-exercise-group` dla wszystkich zasobów w tym ćwiczeniu.</span><span class="sxs-lookup"><span data-stu-id="16c81-127">Create a resource group called `keyvault-exercise-group` for all of the resources in this exercise.</span></span> <span data-ttu-id="16c81-128">Na końcu tego modułu usuniemy tę grupę zasobów, aby wyczyścić wszystkie elementy na raz.</span><span class="sxs-lookup"><span data-stu-id="16c81-128">At the end of this module, we'll be deleting this resource group to clean up everything at once.</span></span> <span data-ttu-id="16c81-129">Dla wszystkich elementów w tym ćwiczeniu użyjemy lokalizacji `eastus`.</span><span class="sxs-lookup"><span data-stu-id="16c81-129">We'll use `eastus` as the location for everything in this exercise.</span></span>

<span data-ttu-id="16c81-130">Użyj terminalu usługi Azure Cloud Shell po prawej stronie, aby uruchomić poniższe polecenie interfejsu wiersza polecenia platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="16c81-130">Use the Azure Cloud Shell terminal on the right to run the following Azure CLI command.</span></span> <span data-ttu-id="16c81-131">Spowoduje to utworzenie grupy zasobów w subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="16c81-131">This will create the resource group in your subscription.</span></span>

```azurecli
az group create --name keyvault-exercise-group --location eastus
```

### <a name="create-the-vault-and-store-the-secret-in-it"></a><span data-ttu-id="16c81-132">Tworzenie magazynu i przechowywanie w nim wpisu tajnego</span><span class="sxs-lookup"><span data-stu-id="16c81-132">Create the vault and store the secret in it</span></span>

<span data-ttu-id="16c81-133">Następnie utworzymy magazyn i będziemy w nim przechowywać nasz wpis tajny.</span><span class="sxs-lookup"><span data-stu-id="16c81-133">Next, we'll create the vault and store our secret in it.</span></span>

<span data-ttu-id="16c81-134">**Nazwy magazynów Key Vault muszą być globalnie unikatowe, dlatego musisz wybrać unikatową nazwę**.</span><span class="sxs-lookup"><span data-stu-id="16c81-134">**Key Vault names must be globally unique, so you'll need to pick a unique name**.</span></span> <span data-ttu-id="16c81-135">Nazwy magazynów muszą zawierać od 3 do 24 znaków oraz wyłącznie znaki alfanumeryczne i łączniki.</span><span class="sxs-lookup"><span data-stu-id="16c81-135">Vault names must be 3-24 characters long and contain only alphanumeric characters and dashes.</span></span>

```azurecli
az keyvault create --name <your-unique-vault-name> --resource-group keyvault-exercise-group --location eastus
```

<span data-ttu-id="16c81-136">Po zakończeniu zobaczysz dane wyjściowe JSON opisujące nowy magazyn.</span><span class="sxs-lookup"><span data-stu-id="16c81-136">When it finishes, you'll see JSON output describing the new vault.</span></span>

<span data-ttu-id="16c81-137">Teraz dodaj wpis tajny: nasz wpis tajny będzie miał nazwę **SecretPassword** o wartości **reindeer_flotilla**.</span><span class="sxs-lookup"><span data-stu-id="16c81-137">Now add the secret: our secret will be named **SecretPassword** with a value of **reindeer_flotilla**.</span></span>

```azurecli
az keyvault secret set --name SecretPassword --value open_sesame --vault-name <your-unique-vault-name>
```

<span data-ttu-id="16c81-138">Zanotuj nazwę magazynu &mdash;, ponieważ będziesz jej wkrótce ponownie potrzebować.</span><span class="sxs-lookup"><span data-stu-id="16c81-138">Make a note of the vault name &mdash; you'll be needing it again soon.</span></span>

<span data-ttu-id="16c81-139">Będziemy wkrótce pisać kod dla naszej aplikacji, ale najpierw musimy dowiedzieć się trochę na temat sposobu uwierzytelniania naszej aplikacji w magazynie.</span><span class="sxs-lookup"><span data-stu-id="16c81-139">We'll write the code for our application shortly, but first we need to learn a little bit about how our app is going to authenticate to a vault.</span></span>